name: Openshift Deployment

on:
  workflow_dispatch:
    inputs:
      REGISTRY_NAMESPACE:
        required: true
        default: rh_ee_mrudraia
      IMAGE_TAG:
        required: false
        default: ""

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Download Openshift CLI
      run: curl "https://downloads-openshift-console.apps.marula-cl.ocs-osd.syseng.devcluster.openshift.com/amd64/linux/oc.tar"

    - name: Install the Openshift cli
      run: tar -xvf oc.tar | sudo mv oc /usr/local/bin/

    - name: Login to Openshift
      run: oc login --token=${{ secrets.OPENSHIFT_TOKEN }} --server=${{ secrets.OPENSHIFT_SERVER }}

    - name: Deploy to Openshift
      run: oc apply -f ecommerce-k8s/